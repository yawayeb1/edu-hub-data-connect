# Troubleshooting 404 Error on Bundles Table

## The Problem
You're getting a 404 error when trying to fetch bundles:
```
https://govczebcnjnstlnmguri.supabase.co/rest/v1/bundles?... 404 (Not Found)
```

## Possible Causes & Solutions

### 1. **Table Doesn't Exist** (Most Likely)

**Check:**
1. Go to your Supabase dashboard
2. Navigate to **Table Editor**
3. Look for the `bundles` table

**If it doesn't exist:**
1. Go to **SQL Editor** in Supabase
2. Run the entire `supabase-schema.sql` file
3. Verify the table was created

**Quick Fix SQL:**
```sql
-- Check if table exists
SELECT table_name 
FROM information_schema.tables 
WHERE table_name = 'bundles';

-- If it doesn't exist, create it:
CREATE TABLE bundles (
  id bigint generated by default as identity primary key,
  network text not null check (network in ('MTN', 'AT_ISHARE', 'AT_BIGTIME', 'TELECEL', 'MTN_UP2U')),
  display_name text not null,
  data_amount_gb numeric(8,2) not null,
  price_ghc numeric(10,2) not null,
  is_active boolean default true,
  sort_order int default 0,
  created_at timestamp with time zone default now()
);
```

### 2. **RLS Policy Issue**

**Check RLS:**
```sql
-- Check if RLS is enabled
SELECT tablename, rowsecurity 
FROM pg_tables 
WHERE tablename = 'bundles';

-- Check policies
SELECT policyname, cmd, qual
FROM pg_policies
WHERE tablename = 'bundles';
```

**Fix RLS Policy:**
```sql
-- Enable RLS
ALTER TABLE bundles ENABLE ROW LEVEL SECURITY;

-- Drop and recreate policy
DROP POLICY IF EXISTS "Public can view active bundles" ON bundles;

CREATE POLICY "Public can view active bundles" 
  ON bundles FOR SELECT 
  USING (is_active = true);
```

### 3. **Environment Variables Not Set**

**Check your `.env` file:**
```env
VITE_SUPABASE_URL=https://govczebcnjnstlnmguri.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key-here
```

**Verify:**
1. File is named `.env` (not `.env.example`)
2. Variables start with `VITE_`
3. No quotes around values
4. Restart dev server after creating/updating `.env`

### 4. **Wrong Supabase Project**

**Verify:**
- The URL in your `.env` matches your Supabase project URL
- You're using the correct project's anon key

### 5. **Table in Wrong Schema**

**Check:**
```sql
-- Bundles should be in 'public' schema
SELECT table_schema, table_name
FROM information_schema.tables
WHERE table_name = 'bundles';
```

Should return: `public | bundles`

## Quick Diagnostic Steps

1. **Run the verification SQL:**
   - Open `supabase-verify-bundles.sql` in Supabase SQL Editor
   - Run all queries
   - Check the results

2. **Test in Supabase Dashboard:**
   - Go to **Table Editor** → `bundles`
   - Try to view the table
   - If you see "Table not found", the table doesn't exist

3. **Test API directly:**
   - Go to **API** → **REST** in Supabase dashboard
   - Try: `GET /rest/v1/bundles?select=*&network=eq.AT_ISHARE`
   - Check if it returns data

4. **Check Browser Console:**
   - Open browser DevTools
   - Look for the full error message
   - Check Network tab for the exact request URL

## Most Common Fix

**If you haven't run the schema yet:**

1. Copy entire `supabase-schema.sql` file
2. Paste into Supabase SQL Editor
3. Click "Run"
4. Wait for "Success" message
5. Refresh your app

**If table exists but still 404:**

1. Run this in SQL Editor:
```sql
-- Recreate RLS policy
DROP POLICY IF EXISTS "Public can view active bundles" ON bundles;
CREATE POLICY "Public can view active bundles" 
  ON bundles FOR SELECT 
  USING (is_active = true);
```

2. Restart your dev server
3. Clear browser cache
4. Try again

## Still Not Working?

1. Check Supabase project status (not paused/sleeping)
2. Verify you're using the correct project
3. Check Supabase logs: **Logs** → **API Logs**
4. Try creating a test bundle manually in Table Editor
5. Verify your `.env` file is being loaded (check console for Supabase client errors)

